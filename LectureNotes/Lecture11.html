<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Julia Schedler">

<title>Fall 24 Stat 416 Lecture Notes - Lecture 11</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../LectureNotes/Lecture10.html">Week 6</a></li><li class="breadcrumb-item"><a href="../LectureNotes/Lecture11.html">Lecture 11</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Fall 24 Stat 416 Lecture Notes</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Week 1</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../LectureNotes/Lecture1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../LectureNotes/Lecture2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Assignments/Assignment1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 1</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Week 2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../LectureNotes/Lecture3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../LectureNotes/Lecture4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Assignments/Assignment2_updated.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 2</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Week 3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../LectureNotes/Lecture5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 5</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../LectureNotes/Lecture6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 6</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Assignments/Assignment3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 3</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Week 4</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../LectureNotes/Lecture7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 7 Solutions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../LectureNotes/Lecture8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 8 (with solutions)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Week 5</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../LectureNotes/Lecture9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 9</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Week 6</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../LectureNotes/Lecture10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 10</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../LectureNotes/Lecture11.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Lecture 11</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Assignments/Assignment4.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignment 4 due 11/4 at midnight</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#announcements" id="toc-announcements" class="nav-link active" data-scroll-target="#announcements">Announcements</a></li>
  <li><a href="#last-time" id="toc-last-time" class="nav-link" data-scroll-target="#last-time">Last time</a></li>
  <li><a href="#is-the-trend-linear" id="toc-is-the-trend-linear" class="nav-link" data-scroll-target="#is-the-trend-linear">Is the trend <em>linear</em>?</a></li>
  <li><a href="#try-taking-the-log" id="toc-try-taking-the-log" class="nav-link" data-scroll-target="#try-taking-the-log">Try taking the log?</a></li>
  <li><a href="#try-differencing" id="toc-try-differencing" class="nav-link" data-scroll-target="#try-differencing">Try differencing?</a></li>
  <li><a href="#unit-root-tests" id="toc-unit-root-tests" class="nav-link" data-scroll-target="#unit-root-tests">Unit root tests</a></li>
  <li><a href="#whats-a-unit" id="toc-whats-a-unit" class="nav-link" data-scroll-target="#whats-a-unit">What‚Äôs a unit?</a></li>
  <li><a href="#whats-a-root-of-a-polynomial" id="toc-whats-a-root-of-a-polynomial" class="nav-link" data-scroll-target="#whats-a-root-of-a-polynomial">What‚Äôs a root of a polynomial?</a></li>
  <li><a href="#what-do-we-care-about-being-one" id="toc-what-do-we-care-about-being-one" class="nav-link" data-scroll-target="#what-do-we-care-about-being-one">What do we care about being one?</a></li>
  <li><a href="#wait-wheres-the-polynomial-advanced-topic" id="toc-wait-wheres-the-polynomial-advanced-topic" class="nav-link" data-scroll-target="#wait-wheres-the-polynomial-advanced-topic">Wait, where‚Äôs the polynomial? (Advanced topic)</a></li>
  <li><a href="#unit-root-test-in-r-using-features-function" id="toc-unit-root-test-in-r-using-features-function" class="nav-link" data-scroll-target="#unit-root-test-in-r-using-features-function"><span class="r-fit-text">Unit root test in <code>R</code> using <code>features</code> function</span></a></li>
  <li><a href="#activity-0" id="toc-activity-0" class="nav-link" data-scroll-target="#activity-0">Activity 0</a></li>
  <li><a href="#in-practice" id="toc-in-practice" class="nav-link" data-scroll-target="#in-practice">In practice</a></li>
  <li><a href="#recall-the-arima-modeling-workflow" id="toc-recall-the-arima-modeling-workflow" class="nav-link" data-scroll-target="#recall-the-arima-modeling-workflow">Recall the ARIMA modeling workflow</a></li>
  <li><a href="#activity-1-manual-analysis" id="toc-activity-1-manual-analysis" class="nav-link" data-scroll-target="#activity-1-manual-analysis">Activity 1: Manual analysis</a></li>
  <li><a href="#activity-1-solutions-manual" id="toc-activity-1-solutions-manual" class="nav-link" data-scroll-target="#activity-1-solutions-manual">Activity 1 Solutions (manual)</a></li>
  <li><a href="#handy-table" id="toc-handy-table" class="nav-link" data-scroll-target="#handy-table">Handy table</a></li>
  <li><a href="#activity-1-solutions-manual-1" id="toc-activity-1-solutions-manual-1" class="nav-link" data-scroll-target="#activity-1-solutions-manual-1">Activity 1 Solutions (manual)</a></li>
  <li><a href="#activity-1-solutions" id="toc-activity-1-solutions" class="nav-link" data-scroll-target="#activity-1-solutions">Activity 1 Solutions</a></li>
  <li><a href="#what-about-automatic" id="toc-what-about-automatic" class="nav-link" data-scroll-target="#what-about-automatic">What about automatic?</a></li>
  <li><a href="#specifying-d-in-the-arima-call" id="toc-specifying-d-in-the-arima-call" class="nav-link" data-scroll-target="#specifying-d-in-the-arima-call">Specifying <span class="math inline">\(d\)</span> in the <code>ARIMA</code> call</a></li>
  <li><a href="#going-fully-automated" id="toc-going-fully-automated" class="nav-link" data-scroll-target="#going-fully-automated">Going fully automated</a></li>
  <li><a href="#activity-2-should-we-go-fully-automated" id="toc-activity-2-should-we-go-fully-automated" class="nav-link" data-scroll-target="#activity-2-should-we-go-fully-automated">Activity 2: Should we go fully automated??</a></li>
  <li><a href="#using-the-sarima-function-for-diagnostics" id="toc-using-the-sarima-function-for-diagnostics" class="nav-link" data-scroll-target="#using-the-sarima-function-for-diagnostics">Using the <code>sarima</code> function for diagnostics</a></li>
  <li><a href="#activity-3-p-values-for-ljung-box-statistic" id="toc-activity-3-p-values-for-ljung-box-statistic" class="nav-link" data-scroll-target="#activity-3-p-values-for-ljung-box-statistic">Activity 3: p-values for Ljung-Box statistic</a></li>
  <li><a href="#testing-if-the-residuals-are-white-noise" id="toc-testing-if-the-residuals-are-white-noise" class="nav-link" data-scroll-target="#testing-if-the-residuals-are-white-noise">Testing if the residuals are white noise</a></li>
  <li><a href="#ljung-box-in-fable" id="toc-ljung-box-in-fable" class="nav-link" data-scroll-target="#ljung-box-in-fable">Ljung-box in <code>fable</code></a></li>
  <li><a href="#seasonal-arima-models" id="toc-seasonal-arima-models" class="nav-link" data-scroll-target="#seasonal-arima-models">Seasonal Arima models</a>
  <ul class="collapse">
  <li><a href="#goal-define-seasonal-arima-model" id="toc-goal-define-seasonal-arima-model" class="nav-link" data-scroll-target="#goal-define-seasonal-arima-model">Goal: define Seasonal Arima model</a></li>
  <li><a href="#pure-seasonal-arima" id="toc-pure-seasonal-arima" class="nav-link" data-scroll-target="#pure-seasonal-arima">Pure Seasonal ARIMA</a></li>
  <li><a href="#simulating-a-pure-seasonal-ar1-process" id="toc-simulating-a-pure-seasonal-ar1-process" class="nav-link" data-scroll-target="#simulating-a-pure-seasonal-ar1-process">Simulating a pure seasonal AR(1) process</a></li>
  <li><a href="#hawaiian-quarterly-occupancy" id="toc-hawaiian-quarterly-occupancy" class="nav-link" data-scroll-target="#hawaiian-quarterly-occupancy">Hawaiian Quarterly Occupancy</a></li>
  <li><a href="#hawaiian-quarterly-occupancy-1" id="toc-hawaiian-quarterly-occupancy-1" class="nav-link" data-scroll-target="#hawaiian-quarterly-occupancy-1">Hawaiian Quarterly Occupancy</a></li>
  <li><a href="#carbon-dioxide-readings" id="toc-carbon-dioxide-readings" class="nav-link" data-scroll-target="#carbon-dioxide-readings">Carbon Dioxide Readings</a></li>
  <li><a href="#whats-the-acf" id="toc-whats-the-acf" class="nav-link" data-scroll-target="#whats-the-acf">What‚Äôs the acf?</a></li>
  <li><a href="#lets-try-a-seasonal-difference" id="toc-lets-try-a-seasonal-difference" class="nav-link" data-scroll-target="#lets-try-a-seasonal-difference">Let‚Äôs try a seasonal difference!</a></li>
  <li><a href="#check-the-acf" id="toc-check-the-acf" class="nav-link" data-scroll-target="#check-the-acf">Check the acf</a></li>
  <li><a href="#difference-and-seasonal-difference" id="toc-difference-and-seasonal-difference" class="nav-link" data-scroll-target="#difference-and-seasonal-difference">Difference and Seasonal Difference</a></li>
  <li><a href="#finding-pq-and-pq" id="toc-finding-pq-and-pq" class="nav-link" data-scroll-target="#finding-pq-and-pq">Finding <span class="math inline">\(p,q\)</span> and <span class="math inline">\(P,Q\)</span></a></li>
  <li><a href="#pq-and-pq-for-carbon-dioxide" id="toc-pq-and-pq-for-carbon-dioxide" class="nav-link" data-scroll-target="#pq-and-pq-for-carbon-dioxide"><span class="math inline">\(p,q\)</span> and <span class="math inline">\(P,Q\)</span> for Carbon Dioxide</a></li>
  <li><a href="#fit-arima011times011_12" id="toc-fit-arima011times011_12" class="nav-link" data-scroll-target="#fit-arima011times011_12">Fit <span class="math inline">\(ARIMA(0,1,1)\times(0,1,1)_{12}\)</span></a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#increase-order-of-ma" id="toc-increase-order-of-ma" class="nav-link" data-scroll-target="#increase-order-of-ma">Increase order of MA</a></li>
  <li><a href="#forecasting" id="toc-forecasting" class="nav-link" data-scroll-target="#forecasting">Forecasting</a></li>
  <li><a href="#compare-to-auto-arima" id="toc-compare-to-auto-arima" class="nav-link" data-scroll-target="#compare-to-auto-arima">Compare to auto arima</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../LectureNotes/Lecture10.html">Week 6</a></li><li class="breadcrumb-item"><a href="../LectureNotes/Lecture11.html">Lecture 11</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Lecture 11</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Julia Schedler </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="announcements" class="level2">
<h2 class="anchored" data-anchor-id="announcements">Announcements</h2>
<ul>
<li>Assignment 4 posted</li>
</ul>
</section>
<section id="last-time" class="level2">
<h2 class="anchored" data-anchor-id="last-time">Last time</h2>
<p>U.S. GNP data‚Äì clearly has a trend, nonstationary</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp3); <span class="fu">library</span>(astsa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'tsibble':
  method               from 
  as_tibble.grouped_df dplyr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>‚îÄ‚îÄ Attaching packages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ fpp3 1.0.1 ‚îÄ‚îÄ</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>‚úî tibble      3.2.1     ‚úî tsibble     1.1.5
‚úî dplyr       1.1.4     ‚úî tsibbledata 0.4.1
‚úî tidyr       1.3.1     ‚úî feasts      0.4.1
‚úî lubridate   1.9.3     ‚úî fable       0.4.0
‚úî ggplot2     3.5.1     </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>‚îÄ‚îÄ Conflicts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ fpp3_conflicts ‚îÄ‚îÄ
‚úñ lubridate::date()    masks base::date()
‚úñ dplyr::filter()      masks stats::filter()
‚úñ tsibble::intersect() masks base::intersect()
‚úñ tsibble::interval()  masks lubridate::interval()
‚úñ dplyr::lag()         masks stats::lag()
‚úñ tsibble::setdiff()   masks base::setdiff()
‚úñ tsibble::union()     masks base::union()</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(gnp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="is-the-trend-linear" class="level2">
<h2 class="anchored" data-anchor-id="is-the-trend-linear">Is the trend <em>linear</em>?</h2>
<p>Not exactly‚Ä¶</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(gnp)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(gnp<span class="sc">~</span><span class="fu">time</span>(gnp)), <span class="at">col =</span> <span class="st">"blueviolet"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="try-taking-the-log" class="level2">
<h2 class="anchored" data-anchor-id="try-taking-the-log">Try taking the log?</h2>
<p>Much better! But, still not stationary.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>log_gnp <span class="ot">&lt;-</span> <span class="fu">log</span>(gnp)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(log_gnp)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(log_gnp<span class="sc">~</span><span class="fu">time</span>(log_gnp)), <span class="at">col =</span> <span class="st">"blueviolet"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="try-differencing" class="level2">
<h2 class="anchored" data-anchor-id="try-differencing">Try differencing?</h2>
<p>Is this stationary? No? Yes? Maybe there‚Äôs a bit of a trend?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(<span class="fu">diff</span>(log_gnp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="unit-root-tests" class="level2">
<h2 class="anchored" data-anchor-id="unit-root-tests">Unit root tests</h2>
<div class="columns">
<div class="column">
<p><strong>Augmented Dickey-Fuller (ADF)</strong></p>
<ul>
<li><p>Null hypothesis: random walk (nonstationary)</p></li>
<li><p>Alternative hypothesis: stationary data</p></li>
</ul>
</div><div class="column">
<p><strong>Kwiatkowski-Phillips-Schmidt-Shin (KPSS)</strong></p>
<ul>
<li><p>Null hypothesis: stationary data</p></li>
<li><p>Alternative hypothesis: nonstationary data</p></li>
</ul>
</div>
</div>
</section>
<section id="whats-a-unit" class="level2">
<h2 class="anchored" data-anchor-id="whats-a-unit">What‚Äôs a unit?</h2>
<p>1 (one)</p>
</section>
<section id="whats-a-root-of-a-polynomial" class="level2">
<h2 class="anchored" data-anchor-id="whats-a-root-of-a-polynomial">What‚Äôs a root of a polynomial?</h2>
<p>Example:Find the roots of <span class="math inline">\(1 - Ax + Bx^2 = 0\)</span></p>
<p>Use the quadratic formula:</p>
<p><span class="math display">\[
x = \frac{A \pm \sqrt{A^2  - 4B }}{2B}
\]</span> A unit root would be where <span class="math inline">\(x = 1\)</span> is a solution.</p>
</section>
<section id="what-do-we-care-about-being-one" class="level2">
<h2 class="anchored" data-anchor-id="what-do-we-care-about-being-one">What do we care about being one?</h2>
<p>For an AR(1),</p>
<p><span class="math display">\[
x_t = \phi x_{t-1} + w_t
\]</span></p>
<p>If <span class="math inline">\(\phi = 1\)</span>, we have a random walk (nonstationary). We‚Äôd like a hypothesis test that is able to use information about plausible values of <span class="math inline">\(\phi\)</span> so that we can see if 1 is plausible.</p>
</section>
<section id="wait-wheres-the-polynomial-advanced-topic" class="level2">
<h2 class="anchored" data-anchor-id="wait-wheres-the-polynomial-advanced-topic">Wait, where‚Äôs the polynomial? (Advanced topic)</h2>
<p>It‚Äôs the AR polynomial‚Äì the polynomial with respect to the lag operator. If the AR polynomial has a unit root, the data are nonstationary.</p>
<p>But since it corresponds to having <span class="math inline">\(\phi = 1\)</span>, we can derive the distribution of our estimate of <span class="math inline">\(\phi\)</span>, <span class="math inline">\(\widehat{\phi}\)</span>, and use reasonable distributional assumptions so that we can calculate a p-value. If the roots are less than or equal to 1, that‚Äôs nonstationary.</p>
</section>
<section id="unit-root-test-in-r-using-features-function" class="level2">
<h2 class="anchored" data-anchor-id="unit-root-test-in-r-using-features-function"><span class="r-fit-text">Unit root test in <code>R</code> using <code>features</code> function</span></h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>log_gnp <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diff</span>() <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(value, unitroot_kpss)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 2
  kpss_stat kpss_pvalue
      &lt;dbl&gt;       &lt;dbl&gt;
1     0.141         0.1</code></pre>
</div>
</div>
<p>Since the p-value is small, we fail to reject the null hypothesis that the data is not stationary.</p>
</section>
<section id="activity-0" class="level2">
<h2 class="anchored" data-anchor-id="activity-0">Activity 0</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## find the number of differences needed to make the *original* data (not log transformed) stationary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="in-practice" class="level2">
<h2 class="anchored" data-anchor-id="in-practice">In practice</h2>
<p>Use the <code>unitroot_ndiffs()</code> function to figure out how many differences you need.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ndiffs_lognp <span class="ot">&lt;-</span> log_gnp <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(value, unitroot_ndiffs)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>ndiffs_lognp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 1
  ndiffs
   &lt;int&gt;
1      1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## note-- if we did not take the log, it says we'd need two!</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>gnp <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(value, unitroot_ndiffs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 1
  ndiffs
   &lt;int&gt;
1      2</code></pre>
</div>
</div>
</section>
<section id="recall-the-arima-modeling-workflow" class="level2">
<h2 class="anchored" data-anchor-id="recall-the-arima-modeling-workflow">Recall the ARIMA modeling workflow</h2>
<p><img src="https://otexts.com/fpp3/figs/arimaflowchart.png" class="img-fluid"></p>
</section>
<section id="activity-1-manual-analysis" class="level2">
<h2 class="anchored" data-anchor-id="activity-1-manual-analysis">Activity 1: Manual analysis</h2>
<ul>
<li><p>Find the order of the ARMA(p,q) process for the log differenced GNP.</p></li>
<li><p>Check the residuals</p></li>
</ul>
</section>
<section id="activity-1-solutions-manual" class="level2">
<h2 class="anchored" data-anchor-id="activity-1-solutions-manual">Activity 1 Solutions (manual)</h2>
<p>Manual: look at ACF and PACF. The ACF maybe cuts at lag 2 and the PACF appears to tail off. So maybe MA(2)?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>diff_log_gnp <span class="ot">&lt;-</span> <span class="fu">diff</span>(log_gnp, <span class="at">differences =</span> ndiffs_lognp<span class="sc">$</span>ndiffs)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>diff_log_gnp <span class="sc">|&gt;</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">acf1</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  0.35  0.19 -0.01 -0.12 -0.17 -0.11 -0.09 -0.04  0.04  0.05  0.03 -0.12
[13] -0.13 -0.10 -0.11  0.05  0.07  0.10  0.06  0.07 -0.09 -0.05 -0.10 -0.05
[25]  0.00</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>diff_log_gnp <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pacf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="handy-table" class="level2">
<h2 class="anchored" data-anchor-id="handy-table">Handy table</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>AR(p)</th>
<th>MA(q)</th>
<th>ARMA(p,q)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ACF</td>
<td>Tails off</td>
<td>Cuts off after lag q</td>
<td>Tails off</td>
</tr>
<tr class="even">
<td>PACF</td>
<td>Cuts off after lag p</td>
<td>Tails off</td>
<td>Tails off</td>
</tr>
</tbody>
</table>
</section>
<section id="activity-1-solutions-manual-1" class="level2">
<h2 class="anchored" data-anchor-id="activity-1-solutions-manual-1">Activity 1 Solutions (manual)</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>diff_log_gnp <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">ARIMA</span>(value <span class="sc">~</span> <span class="fu">pdq</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))) <span class="sc">|&gt;</span> <span class="do">## force nonseasonal</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">report</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: value 
Model: ARIMA(0,0,2) w/ mean 

Coefficients:
         ma1     ma2  constant
      0.3028  0.2035    0.0083
s.e.  0.0654  0.0644    0.0010

sigma^2 estimated as 9.041e-05:  log likelihood=719.96
AIC=-1431.93   AICc=-1431.75   BIC=-1418.32</code></pre>
</div>
</div>
</section>
<section id="activity-1-solutions" class="level2">
<h2 class="anchored" data-anchor-id="activity-1-solutions">Activity 1 Solutions</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>manual_fit <span class="ot">&lt;-</span> diff_log_gnp <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">ARIMA</span>(value <span class="sc">~</span> <span class="fu">pdq</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(manual_fit) <span class="sc">|&gt;</span> <span class="fu">gg_tsdisplay</span>(<span class="at">plot_type =</span> <span class="st">"histogram"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Plot variable not specified, automatically selected `y = .resid`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The residuals look like white noise</p>
</section>
<section id="what-about-automatic" class="level2">
<h2 class="anchored" data-anchor-id="what-about-automatic">What about automatic?</h2>
<p>Different answer‚Äì but, looking at the ACFS, kind of reasonable.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>diff_log_gnp <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">ARIMA</span>(value)) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">report</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: value 
Model: ARIMA(1,0,0) w/ mean 

Coefficients:
         ar1  constant
      0.3467    0.0054
s.e.  0.0627    0.0006

sigma^2 estimated as 9.112e-05:  log likelihood=718.61
AIC=-1431.22   AICc=-1431.11   BIC=-1421.01</code></pre>
</div>
</div>
</section>
<section id="specifying-d-in-the-arima-call" class="level2">
<h2 class="anchored" data-anchor-id="specifying-d-in-the-arima-call">Specifying <span class="math inline">\(d\)</span> in the <code>ARIMA</code> call</h2>
<p>Work with the non-differenced data, and specify <span class="math inline">\(d =1\)</span> in <code>pdq()</code>. We get the same estimated model.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ar1_fit_fable <span class="ot">&lt;-</span> log_gnp <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">ARIMA</span>(value <span class="sc">~</span> <span class="fu">pdq</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))) <span class="do">## force nonseasonal</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">report</span>(ar1_fit_fable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: value 
Model: ARIMA(1,1,0) w/ drift 

Coefficients:
         ar1  constant
      0.3467    0.0054
s.e.  0.0627    0.0006

sigma^2 estimated as 9.136e-05:  log likelihood=718.61
AIC=-1431.22   AICc=-1431.11   BIC=-1421.01</code></pre>
</div>
</div>
</section>
<section id="going-fully-automated" class="level2">
<h2 class="anchored" data-anchor-id="going-fully-automated">Going fully automated</h2>
<p>Allow <code>ARIMA</code> to choose the order of the differencing <span class="math inline">\(d\)</span> and <span class="math inline">\(p,q\)</span>.</p>
<p>Based on corrected AIC, this is slightly better than our model. But this model is quite complicated!</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>fully_auto_fit <span class="ot">&lt;-</span> log_gnp <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">ARIMA</span>(value <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))) <span class="sc">|&gt;</span> <span class="do">## force nonseasonal</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">report</span>(fully_auto_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: value 
Model: ARIMA(3,1,1) w/ drift 

Coefficients:
         ar1      ar2      ar3      ma1  constant
      1.0905  -0.1251  -0.1739  -0.7881    0.0017
s.e.  0.3027   0.1529   0.0777   0.3112    0.0001

sigma^2 estimated as 8.906e-05:  log likelihood=722.89
AIC=-1433.78   AICc=-1433.39   BIC=-1413.36</code></pre>
</div>
</div>
</section>
<section id="activity-2-should-we-go-fully-automated" class="level2">
<h2 class="anchored" data-anchor-id="activity-2-should-we-go-fully-automated">Activity 2: Should we go fully automated??</h2>
<ul>
<li><p>Go to the <a href="https://github.com/nickpoison/astsa/blob/master/fun_with_astsa/fun_with_astsa.md">ASTSA package github</a> and click ‚ÄúEstimation‚Äù under 4.ARIMA</p></li>
<li><p>Read between the watermelon üçâ and alien üëΩ</p></li>
<li><p>Are they using the <code>ARIMA</code> function? Is the function they are using different?</p></li>
<li><p>Explain how the code under ‚ÄúDON‚ÄôT BELIEVE IT?? OK‚Ä¶ HERE YOU GO‚Äù provides evidence that automatic arima functions don‚Äôt work</p></li>
</ul>
</section>
<section id="using-the-sarima-function-for-diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="using-the-sarima-function-for-diagnostics">Using the <code>sarima</code> function for diagnostics</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sarima</span>(log_gnp, <span class="at">p =</span> <span class="dv">1</span>, <span class="at">d =</span> <span class="dv">1</span>, <span class="at">q =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>initial  value -4.589567 
iter   2 value -4.654150
iter   3 value -4.654150
iter   4 value -4.654151
iter   4 value -4.654151
iter   4 value -4.654151
final  value -4.654151 
converged
initial  value -4.655919 
iter   2 value -4.655921
iter   3 value -4.655921
iter   4 value -4.655922
iter   5 value -4.655922
iter   5 value -4.655922
iter   5 value -4.655922
final  value -4.655922 
converged
&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;
 
Coefficients: 
         Estimate     SE t.value p.value
ar1        0.3467 0.0627  5.5255       0
constant   0.0083 0.0010  8.5398       0

sigma^2 estimated as 9.029576e-05 on 220 degrees of freedom 
 
AIC = -6.446939  AICc = -6.446692  BIC = -6.400957 
 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="activity-3-p-values-for-ljung-box-statistic" class="level2">
<h2 class="anchored" data-anchor-id="activity-3-p-values-for-ljung-box-statistic">Activity 3: p-values for Ljung-Box statistic</h2>
<ul>
<li><p>When an R function for fitting a model gives you a diagnostic plot by default, it‚Äôs good to understand that plot‚Äì it‚Äôs probably useful!</p></li>
<li><p>Use whatever resources you can to figure out what that bottom plot means</p></li>
</ul>
</section>
<section id="testing-if-the-residuals-are-white-noise" class="level2">
<h2 class="anchored" data-anchor-id="testing-if-the-residuals-are-white-noise">Testing if the residuals are white noise</h2>
<p>Portmanteau tests (French for suitcase or coat rack carrying several items of clothing) (do the residuals ‚Äúcarry information‚Äù</p>
<ul>
<li><p><strong>Null hypothesis</strong>: Residuals are generated by a white noise process.</p></li>
<li><p><strong>Alternative hypothesis</strong>: Residuals are not generated by a white noise process.</p></li>
</ul>
<p>Lots of options for tests, we will use <strong>Ljung-Box</strong> (default output)</p>
</section>
<section id="ljung-box-in-fable" class="level2">
<h2 class="anchored" data-anchor-id="ljung-box-in-fable">Ljung-box in <code>fable</code></h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(ar1_fit_fable) <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">features</span>(.resid,ljung_box, <span class="at">lag =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 3
  .model                                     lb_stat lb_pvalue
  &lt;chr&gt;                                        &lt;dbl&gt;     &lt;dbl&gt;
1 ARIMA(value ~ pdq(1, 1, 0) + PDQ(0, 0, 0))    10.7     0.382</code></pre>
</div>
</div>
</section>
<section id="seasonal-arima-models" class="level1">
<h1>Seasonal Arima models</h1>
<section id="goal-define-seasonal-arima-model" class="level2">
<h2 class="anchored" data-anchor-id="goal-define-seasonal-arima-model">Goal: define Seasonal Arima model</h2>
<p>Want:</p>
<p><span class="math display">\[
ARIMA(p, d, q)\times(P,D,Q)_{S}
\]</span></p>
<ul>
<li><p>first part is the same as before‚Äì nonseasonal</p></li>
<li><p>second part is similar to before, but we interpret lags as having a seasonal period.</p></li>
</ul>
</section>
<section id="pure-seasonal-arima" class="level2">
<h2 class="anchored" data-anchor-id="pure-seasonal-arima">Pure Seasonal ARIMA</h2>
<p>A time series <span class="math inline">\(x_t\)</span> is said to follow a Pure Seasonal ARIMA model, with parameters <span class="math inline">\(P, D, Q\)</span>, and seasonal period <span class="math inline">\(S\)</span> (or <span class="math inline">\(T\)</span>), if</p>
<ul>
<li><p><span class="math inline">\(x_t\)</span> has a seasonal component with period <span class="math inline">\(S\)</span></p></li>
<li><p>is ARIMA(P,D,Q) where we interpret the lag as a <em>seasonal lag</em>, i.e.&nbsp;lagging by <span class="math inline">\(S\)</span></p></li>
</ul>
</section>
<section id="simulating-a-pure-seasonal-ar1-process" class="level2">
<h2 class="anchored" data-anchor-id="simulating-a-pure-seasonal-ar1-process">Simulating a pure seasonal AR(1) process</h2>
<p>Notice the peaks every January‚Äì the seasonal period here is 12 (or 1 if we divide by 12).</p>
<p>The same ‚Äútailing off‚Äù/‚Äúcutting off‚Äù behavior is the same, but we look for <strong>seasonal spikes</strong></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="hawaiian-quarterly-occupancy" class="level2">
<h2 class="anchored" data-anchor-id="hawaiian-quarterly-occupancy">Hawaiian Quarterly Occupancy</h2>
<p>The two plots show the time series, and the extracted seasonal component.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="hawaiian-quarterly-occupancy-1" class="level2">
<h2 class="anchored" data-anchor-id="hawaiian-quarterly-occupancy-1">Hawaiian Quarterly Occupancy</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="carbon-dioxide-readings" class="level2">
<h2 class="anchored" data-anchor-id="carbon-dioxide-readings">Carbon Dioxide Readings</h2>
<p>Monthly <span class="math inline">\(CO_2\)</span> readings at Mauna Loa Observatory</p>
<p>Do we see a seasonal pattern?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(cardox, <span class="at">col=</span><span class="dv">4</span>, <span class="at">ylab=</span><span class="fu">expression</span>(CO[<span class="dv">2</span>]))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Monthly Carbon Dioxide Readings - Mauna Loa Observatory "</span>, <span class="at">cex.main=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="whats-the-acf" class="level2">
<h2 class="anchored" data-anchor-id="whats-the-acf">What‚Äôs the acf?</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(cardox)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="lets-try-a-seasonal-difference" class="level2">
<h2 class="anchored" data-anchor-id="lets-try-a-seasonal-difference">Let‚Äôs try a seasonal difference!</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(<span class="fu">diff</span>(cardox,<span class="dv">12</span>), <span class="at">col=</span><span class="dv">4</span>, </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="at">ylab=</span><span class="fu">expression</span>(nabla[<span class="dv">12</span>]<span class="sc">~</span>CO[<span class="dv">2</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="check-the-acf" class="level2">
<h2 class="anchored" data-anchor-id="check-the-acf">Check the acf</h2>
<p>Still a trend..difference again?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">diff</span>(cardox, <span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="difference-and-seasonal-difference" class="level2">
<h2 class="anchored" data-anchor-id="difference-and-seasonal-difference">Difference and Seasonal Difference</h2>
<p>Looks pretty stationary!</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(<span class="fu">diff</span>(<span class="fu">diff</span>(cardox, <span class="dv">12</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="finding-pq-and-pq" class="level2">
<h2 class="anchored" data-anchor-id="finding-pq-and-pq">Finding <span class="math inline">\(p,q\)</span> and <span class="math inline">\(P,Q\)</span></h2>
<p>We have identified <span class="math inline">\(d = 1\)</span> and <span class="math inline">\(D=1\)</span>.</p>
<ul>
<li><p><strong>SEASONAL</strong>: Check acf/pacf for <span class="math inline">\(P,Q\)</span> and recall the seasonal period (here 12/12 = 1)</p></li>
<li><p><strong>NON-SEASONAL</strong>: Check acf/pacf for <span class="math inline">\(p,q\)</span> just like before.</p></li>
</ul>
</section>
<section id="pq-and-pq-for-carbon-dioxide" class="level2">
<h2 class="anchored" data-anchor-id="pq-and-pq-for-carbon-dioxide"><span class="math inline">\(p,q\)</span> and <span class="math inline">\(P,Q\)</span> for Carbon Dioxide</h2>
<ul>
<li><p><strong>Seasonal</strong>: ACF appears to cut off at lag 1 (12 months), but tails of at lags 1, 2, 3, 4‚Äì implies a <em>seasonal</em> moving average, so <span class="math inline">\(Q=1, P= 0\)</span>.</p></li>
<li><p><strong>Non-seasonal</strong>: Appears to cut off at lag 1 (1/12) and PACF tails off. Looks like a MA(1), so <span class="math inline">\(q = 1, p = 0\)</span>.</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">acf1</span>(<span class="fu">diff</span>(<span class="fu">diff</span>(cardox, <span class="dv">12</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -0.30 -0.03 -0.06  0.00  0.00 -0.01  0.03 -0.01  0.05 -0.03  0.19 -0.47
[13]  0.08  0.08  0.00  0.02 -0.05  0.04 -0.04 -0.01 -0.02  0.02 -0.04  0.00
[25]  0.03 -0.06  0.04 -0.03  0.06 -0.03 -0.04  0.04  0.01  0.02  0.00  0.01
[37]  0.04 -0.01 -0.01 -0.01 -0.01 -0.03  0.03  0.03 -0.05  0.00  0.02 -0.02</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(<span class="fu">diff</span>(<span class="fu">diff</span>(cardox,<span class="dv">12</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fit-arima011times011_12" class="level2">
<h2 class="anchored" data-anchor-id="fit-arima011times011_12">Fit <span class="math inline">\(ARIMA(0,1,1)\times(0,1,1)_{12}\)</span></h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sarima</span>(cardox, <span class="at">p =</span> <span class="dv">0</span>, <span class="at">d =</span> <span class="dv">1</span>, <span class="at">q =</span> <span class="dv">1</span>, <span class="at">P =</span> <span class="dv">0</span>, <span class="at">D =</span> <span class="dv">1</span>, <span class="at">Q =</span> <span class="dv">1</span>, <span class="at">S =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>initial  value -0.826338 
iter   2 value -1.059073
iter   3 value -1.093845
iter   4 value -1.116555
iter   5 value -1.124382
iter   6 value -1.126345
iter   7 value -1.127354
iter   8 value -1.127953
iter   9 value -1.127984
iter  10 value -1.127985
iter  10 value -1.127985
iter  10 value -1.127985
final  value -1.127985 
converged
initial  value -1.144615 
iter   2 value -1.148048
iter   3 value -1.148645
iter   4 value -1.149895
iter   5 value -1.150013
iter   6 value -1.150021
iter   7 value -1.150021
iter   7 value -1.150021
iter   7 value -1.150021
final  value -1.150021 
converged
&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;
 
Coefficients: 
     Estimate     SE  t.value p.value
ma1   -0.3869 0.0377 -10.2624       0
sma1  -0.8655 0.0183 -47.2846       0

sigma^2 estimated as 0.0980908 on 766 degrees of freedom 
 
AIC = 0.5456475  AICc = 0.545668  BIC = 0.5637873 
 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<ul>
<li><p>may still have some residual autocorrelation (Ljung-box test for small lags)</p></li>
<li><p>Try adding another term? maybe increase order of MA or add AR component?</p></li>
</ul>
</section>
<section id="increase-order-of-ma" class="level2">
<h2 class="anchored" data-anchor-id="increase-order-of-ma">Increase order of MA</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sarima</span>(cardox, <span class="at">p =</span> <span class="dv">0</span>, <span class="at">d =</span> <span class="dv">1</span>, <span class="at">q =</span> <span class="dv">2</span>, <span class="at">P =</span> <span class="dv">0</span>, <span class="at">D =</span> <span class="dv">1</span>, <span class="at">Q =</span> <span class="dv">1</span>, <span class="at">S =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>initial  value -0.826338 
iter   2 value -1.061232
iter   3 value -1.098226
iter   4 value -1.120391
iter   5 value -1.127720
iter   6 value -1.129516
iter   7 value -1.130690
iter   8 value -1.130938
iter   9 value -1.130955
iter  10 value -1.130959
iter  11 value -1.130959
iter  12 value -1.130959
iter  12 value -1.130959
iter  12 value -1.130959
final  value -1.130959 
converged
initial  value -1.147318 
iter   2 value -1.150711
iter   3 value -1.151405
iter   4 value -1.152442
iter   5 value -1.152564
iter   6 value -1.152573
iter   7 value -1.152574
iter   7 value -1.152574
iter   7 value -1.152574
final  value -1.152574 
converged
&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;
 
Coefficients: 
     Estimate     SE  t.value p.value
ma1   -0.3678 0.0359 -10.2365  0.0000
ma2   -0.0704 0.0354  -1.9911  0.0468
sma1  -0.8651 0.0182 -47.4548  0.0000

sigma^2 estimated as 0.09759346 on 765 degrees of freedom 
 
AIC = 0.5431467  AICc = 0.5431876  BIC = 0.5673331 
 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sarima</span>(cardox, <span class="at">p =</span> <span class="dv">1</span>, <span class="at">d =</span> <span class="dv">1</span>, <span class="at">q =</span> <span class="dv">1</span>, <span class="at">P =</span> <span class="dv">0</span>, <span class="at">D =</span> <span class="dv">1</span>, <span class="at">Q =</span> <span class="dv">1</span>, <span class="at">S =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>initial  value -0.827261 
iter   2 value -1.034332
iter   3 value -1.066295
iter   4 value -1.094823
iter   5 value -1.108013
iter   6 value -1.115246
iter   7 value -1.116173
iter   8 value -1.120248
iter   9 value -1.120892
iter  10 value -1.121657
iter  11 value -1.122186
iter  12 value -1.124590
iter  13 value -1.125269
iter  14 value -1.125654
iter  15 value -1.125685
iter  16 value -1.125685
iter  17 value -1.125687
iter  18 value -1.125689
iter  19 value -1.125689
iter  20 value -1.125689
iter  20 value -1.125689
iter  20 value -1.125689
final  value -1.125689 
converged
initial  value -1.146682 
iter   2 value -1.150731
iter   3 value -1.152123
iter   4 value -1.152815
iter   5 value -1.153157
iter   6 value -1.153220
iter   7 value -1.153266
iter   8 value -1.153337
iter   9 value -1.153352
iter  10 value -1.153359
iter  11 value -1.153384
iter  12 value -1.153388
iter  13 value -1.153390
iter  14 value -1.153390
iter  14 value -1.153390
iter  14 value -1.153390
final  value -1.153390 
converged
&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;
 
Coefficients: 
     Estimate     SE  t.value p.value
ar1    0.2203 0.0894   2.4660  0.0139
ma1   -0.5797 0.0753  -7.7029  0.0000
sma1  -0.8656 0.0182 -47.5947  0.0000

sigma^2 estimated as 0.09742764 on 765 degrees of freedom 
 
AIC = 0.541514  AICc = 0.5415549  BIC = 0.5657004 
 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="forecasting" class="level2">
<h2 class="anchored" data-anchor-id="forecasting">Forecasting</h2>
<p>Looks like we predict the <span class="math inline">\(CO_2\)</span> to continue to increase‚Ä¶</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sarima.for</span>(cardox, <span class="dv">60</span>, <span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>, <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$pred
          Jan      Feb      Mar      Apr      May      Jun      Jul      Aug
2023                            422.5365 423.2516 422.6841 420.8017 418.7844
2024 421.8604 422.7144 423.3343 424.7951 425.4936 424.9223 423.0392 421.0216
2025 424.0976 424.9517 425.5715 427.0323 427.7308 427.1595 425.2764 423.2588
2026 426.3348 427.1889 427.8088 429.2695 429.9680 429.3968 427.5136 425.4961
2027 428.5720 429.4261 430.0460 431.5067 432.2052 431.6340 429.7509 427.7333
2028 430.8092 431.6633 432.2832                                             
          Sep      Oct      Nov      Dec
2023 417.4195 417.6341 419.1994 420.6362
2024 419.6567 419.8713 421.4367 422.8734
2025 421.8940 422.1085 423.6739 425.1106
2026 424.1312 424.3458 425.9111 427.3479
2027 426.3684 426.5830 428.1483 429.5851
2028                                    

$se
           Jan       Feb       Mar       Apr       May       Jun       Jul
2023                               0.3121340 0.3706892 0.4100237 0.4437896
2024 0.6057658 0.6286983 0.6508233 0.6839230 0.7112115 0.7366194 0.7609956
2025 0.8931404 0.9133056 0.9330350 0.9616380 0.9859772 1.0090191 1.0313946
2026 1.1563743 1.1759118 1.1951299 1.2221148 1.2455209 1.2678703 1.2896982
2027 1.4134077 1.4329864 1.4523012 1.4786701 1.5018653 1.5241385 1.5459682
2028 1.6707850 1.6906907 1.7103647                                        
           Aug       Sep       Oct       Nov       Dec
2023 0.4747345 0.5036938 0.5310578 0.5570754 0.5819301
2024 0.7845756 0.8074590 0.8297096 0.8513785 0.8725094
2025 1.0532622 1.0746779 1.0956735 1.1162740 1.1365011
2026 1.3111337 1.3322181 1.3529726 1.3734132 1.3935539
2027 1.5674673 1.5886697 1.6095915 1.6302447 1.6506393
2028                                                  </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fl">2018.9</span>, <span class="at">lty=</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture11_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="compare-to-auto-arima" class="level2">
<h2 class="anchored" data-anchor-id="compare-to-auto-arima">Compare to auto arima</h2>
<p>May be overparameterized‚Ä¶</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>cardox <span class="sc">|&gt;</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">ARIMA</span>(value)) <span class="sc">|&gt;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">report</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: value 
Model: ARIMA(1,1,1)(2,1,2)[12] 

Coefficients:
         ar1      ma1     sar1     sar2     sma1     sma2
      0.2219  -0.5821  -0.3132  -0.0169  -0.5481  -0.2724
s.e.  0.0891   0.0749   1.4611   0.0421   1.4610   1.2649

sigma^2 estimated as 0.09985:  log likelihood=-203.82
AIC=421.65   AICc=421.79   BIC=454.15</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/juliaSchedler\.github\.io\/Stat416_CourseWebsite\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>